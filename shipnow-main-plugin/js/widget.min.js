!function(){"use strict";var n,t=jQuery,o=null,i=null,e=null,s=null,p=null;function c(n){return!isNaN(n)&&n&&4==String(n).length}function a(n,o,i){return o.action=n,t.post(shipnow.ajaxurl,o,(function(n){i(n)}),"json").fail((function(){i(null)}))}function d(n,t){return p=n,a("shipnow_widget_set_post_office",{id:n},t)}function r(e){var s=t(this).closest("form");clearTimeout(n),n=setTimeout((function(){var n=s.find(".shipnow-id-field"),e=s.find(".shipnow-zip-field"),p=s.find(".shipnow-estimator-results"),d=s.find(".shipnow-estimator-error"),r=n.val(),l=e.val();l!=o&&(o=l,i&&i.abort(),t.when(d.stop().slideUp(),p.stop().slideUp()).then((function(){c(l)&&(s.addClass("shipnow-estimator-working"),i=function(n,t,o){return a("shipnow_widget_get_estimate",{id:n,zip:t},o)}(r,l,(function(n){s.removeClass("shipnow-estimator-working"),n&&n.html?(p.html(n.html).slideDown(),p.find(".shipnow-view-postoffices").on("click",(function(n){n.preventDefault(),f(t(this))}))):d.slideDown()})))})))}),800)}function l(n,o){e||(t("body").find(".shipnow-popup").html()&&t("body").find(".shipnow-popup").remove(),e=t(shipnow._popupHtml).insertAfter(t(".shipnow-select-postoffice").parents("li")),s=e.children("div").children("div"),e.find(".shipnow-popup-shadow,.shipnow-close").on("click",(function(n){n.preventDefault(),h()}))),e.stop(),s.html(n),e.show().fadeTo(200,1,(function(){"function"==typeof o&&o()})),e=null}function h(){t(".shipnow-select-postoffice").removeClass("prevent-pointer-event"),e&&e.stop().fadeTo(200,0,(function(){e.hide()}))}function f(n){var o=function(){s.find(".shipnow-select-button").on("click",(function(n){n.preventDefault();var o=t(this).data("id");h(),i&&i.abort(),(i=d(o,(function(){})))&&t(".woocommerce-checkout-payment, .woocommerce-checkout-review-order-table, .cart-collaterals, .woocommerce-cart-form").unblock()}))};if("object"==typeof n&&n)return l(n.parents(".shipnow-estimate").find(".shipnow-estimate-postoffices").html(),o),t(".shipnow-close").next("div").css("padding-top",0),p&&t("#"+p).attr("checked",!0),void h();i=a("shipnow_widget_get_post_offices",{},(function(n){n&&n.html&&(l(n.html,o),p&&t("#"+p).attr("checked",!0),t(".shipnow-close").next("div").css("padding-top",0),h())}))}function u(){var n=function(){var n=s.find(".shipnow-zip-field").val();if(!c(n))return alert(shipnow._invalidZipError),void n.focus();t("#ship-to-different-address-checkbox").prop("checked",!0),t("#shipping_postcode").val(n),h(),i&&i.abort(),i=function(n,t){return a("shipnow_widget_set_zip_code",{zip:n},t)}(n,(function(n){}))};l(shipnow._changeZipHtml,(function(){t(s).find(".shipnow-ok-button").on("click",(function(t){t.preventDefault(),n()})),s.find("input").focus()}))}function w(){t(".woocommerce-shipping-destination,.woocommerce-shipping-calculator,.woocommerce-shipping-fields").show();t(".shipnow-options").remove(),t("input.shipping_method[value^='shipnow_shipping_']").each((function(){var n=t("<a href='#' class='shipnow-select-postoffice'>"+shipnow._selectPostOffice+"</a>"),o=t("<a href='#' class='shipnow-change-zipcode'>"+shipnow._changeZipCode+"</a>"),e=t(this),s=e.parents("li");t("#shipping_method").find(".shipnow-select-button").on("click",(function(n){i&&i.abort(),n.preventDefault();var o=t(this).data("id");t(this).parents("li").children(".shipping_method").attr("id");(i=d(o,(function(n){200==i.status&&(t("body").trigger("update_checkout").trigger("wc_update_cart"),h())})))&&t(".woocommerce-checkout-payment, .woocommerce-checkout-review-order-table, .cart-collaterals, .woocommerce-cart-form").unblock()})),/_pas_/.test(e.attr("id"))?(t(this).attr("disabled","disabled"),t(this).addClass("shipping_pas"),t(this).next("label").addClass("shipping_pas"),e.prop("checked")&&(s.append(t("<div class='shipnow-options' style='display:none !important;'>").append(o).append(n)),t(".shipnow-select-postoffice").addClass("prevent-pointer-event"),n.on("click",(function(n){t(".shipnow-select-postoffice").addClass("prevent-pointer-event"),n.preventDefault(),f()})),o.on("click",(function(n){n.preventDefault(),u()})))):(t(this).addClass("shipping_pap"),t(this).next("label").addClass("shipping_pap"))}))}window.ajax_loading=!1,t.hasAjaxRunning=function(){return window.ajax_loading},t(document).ajaxStart((function(){window.ajax_loading=!0})),t(document).ajaxStop((function(){window.ajax_loading=!1})),t(window).on("load",(function(){t("body").on("input paste change",".shipping-cost .shipnow-zip-field",r).on("keydown",(function(n){13==n.which&&n.preventDefault()})),r(),w(),t("body").on("init_checkout updated_checkout updated_wc_div updated_cart_totals country_to_state_changed updated_shipping_method cart_page_refreshed cart_totals_refreshed wc_fragments_loaded",w)}))}();